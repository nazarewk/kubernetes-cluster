#!/usr/bin/env bash
cd $(dirname "$(readlink -f "$0")")
source cluster-vars
cd ${kubespray_dir}

# based on https://github.com/kubernetes-incubator/kubespray/blob/master/docs/getting-started.md#building-your-own-inventory
cp -r inventory -T ${inventory}
declare -a IPS=($@)
python3 contrib/inventory_builder/inventory.py ${IPS[@]}

cat > ${inventory}/group_vars/all.yml << EOF
bootstrap_os: coreos
kube_basic_auth: true
kubeconfig_localhost: true
kubectl_localhost: true
download_run_once: true
cert_management: "{{ bool(groups.get('vault', None)) }}"
EOF

export ANSIBLE_CONFIG="${base_dir}/ansible.cfg"
