#!/usr/bin/env bash
cd $(dirname "$(readlink -f "$0")")
source ./setup-cluster-vars
cd ${dir}

 based on https://github.com/kubernetes-incubator/kubespray/blob/master/docs/getting-started.md#building-your-own-inventory
cp -r inventory -T ${inventory}
python3 contrib/inventory_builder/inventory.py ${IPS[@]}

cat > ${inventory}/group_vars/all.yml << EOF
bootstrap_os: coreos
#loadbalancer_apiserver:
#  address: 0.0.0.0
#  port: 8080
kube_basic_auth: true
kubeconfig_localhost: true
kubectl_localhost: true
download_run_once: True
EOF

ansible-playbook -i ${inventory}/inventory.cfg cluster.yml -b -v

cd ${dir}/artifacts

echo Staring kubectl proxy
echo http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login
./kubectl proxy

